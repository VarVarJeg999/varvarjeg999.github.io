<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spaceship Builder with Burning Up</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    #parts-list {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #f0f0f0;
      padding: 10px;
      border-radius: 8px;
      max-width: 150px;
      z-index: 10;
    }

    .part-item {
      margin: 5px;
      padding: 8px;
      background-color: #ddd;
      cursor: grab;
      text-align: center;
      border-radius: 4px;
    }

    #launchButton {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      z-index: 10;
    }

    #launchButton:disabled {
      background-color: #ccc;
    }
  </style>
</head>
<body>
  <div id="parts-list"></div>
  <button id="launchButton">Launch</button>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let selectedPart = null;
    let offsetX = 0;
    let offsetY = 0;
    let spaceship = { x: canvas.width / 2, y: canvas.height / 2, speed: 0, parts: [], launched: false };
    let spaceshipParts = [];
    let cameraOffset = { x: 0, y: 0 }; // Camera offset for following the spaceship

    // Load parts from external JSON file located in json/spaceshipParts.json
    async function loadSpaceshipParts() {
      try {
        const response = await fetch("json/spaceshipParts.json");
        spaceshipParts = await response.json();
        loadImagesForParts();
        displayAvailableParts();
      } catch (error) {
        console.error("Failed to load spaceship parts:", error);
      }
    }

    // Load images for parts if an image path or DataURL is provided
    function loadImagesForParts() {
      spaceshipParts.forEach(part => {
        if (part.image) {
          const img = new Image();
          img.src = part.image;
          part.imgElement = img; // Store loaded image element in the part object
        }
        part.heat = 0; // Initialize part's heat level
        part.durability = 100; // Initialize part durability
      });
    }

    function displayAvailableParts() {
      const partsList = document.getElementById("parts-list");
      partsList.innerHTML = "";

      spaceshipParts.forEach(part => {
        const partElement = document.createElement("div");
        partElement.className = "part-item";
        partElement.innerText = part.name;
        partElement.style.backgroundColor = part.color;
        partElement.addEventListener("mousedown", (e) => startDrag(part, e));
        partsList.appendChild(partElement);
      });
    }

    function startDrag(part, event) {
      if (spaceship.launched) return; // Prevent dragging after launch

      selectedPart = { ...part };
      offsetX = event.clientX - (spaceship.x + selectedPart.x);
      offsetY = event.clientY - (spaceship.y + selectedPart.y);

      document.addEventListener("mousemove", dragPart);
      document.addEventListener("mouseup", placePart);
    }

    function dragPart(event) {
      if (selectedPart) {
        selectedPart.x = event.clientX - offsetX - spaceship.x;
        selectedPart.y = event.clientY - offsetY - spaceship.y;
        drawSpaceship();
      }
    }

    function placePart() {
      if (selectedPart) {
        spaceship.parts.push(selectedPart);
        selectedPart = null;

        document.removeEventListener("mousemove", dragPart);
        document.removeEventListener("mouseup", placePart);
        drawSpaceship();
      }
    }

    // Simulate atmosphere and heat generation
    function simulateAtmosphereAndHeat() {
      spaceship.parts.forEach(part => {
        const atmosphereDensity = 0.5; // Simulated atmosphere density
        const speed = spaceship.speed;
        
        part.heat += speed * atmosphereDensity * 0.01; // Increase heat based on speed
        if (part.heat > part.heatTolerance) {
          part.durability -= 1; // Reduce durability if overheating
          if (part.durability <= 0) {
            part.burnedUp = true;
          }
        }
      });
    }

    // Draw the spaceship and parts, including burning effect
    function drawSpaceship() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Adjust the canvas drawing to follow the spaceship
      ctx.save();
      ctx.translate(-cameraOffset.x, -cameraOffset.y);

      // Draw spaceship core
      ctx.fillStyle = "gray";
      ctx.fillRect(spaceship.x - 25, spaceship.y - 25, 50, 50);

      // Draw each part in custom position
      spaceship.parts.forEach(part => {
        if (part.burnedUp) {
          return; // Skip rendering burned-up parts
        }

        if (part.imgElement) {
          ctx.drawImage(
            part.imgElement,
            spaceship.x + part.x - part.size.width / 2,
            spaceship.y + part.y - part.size.height / 2,
            part.size.width,
            part.size.height
          );
        } else {
          ctx.fillStyle = part.color;
          ctx.fillRect(
            spaceship.x + part.x - part.size.width / 2,
            spaceship.y + part.y - part.size.height / 2,
            part.size.width,
            part.size.height
          );
        }

        // Draw burning effect if part is overheating
        if (part.heat > part.heatTolerance) {
          ctx.fillStyle = "rgba(255, 69, 0, 0.5)"; // Orange glow
          ctx.fillRect(
            spaceship.x + part.x - part.size.width / 2,
            spaceship.y + part.y - part.size.height / 2,
            part.size.width,
            part.size.height
          );
        }
      });

      ctx.restore();
    }

    // Launch the spaceship and simulate movement
    function launchSpaceship() {
      spaceship.launched = true;
      document.getElementById("launchButton").disabled = true;
      document.getElementById("parts-list").style.display = "none"; // Hide parts list

      // Simple launch movement simulation
      setInterval(() => {
        if (spaceship.launched) {
          spaceship.speed += 0.1; // Increase speed over time to simulate thrust
          spaceship.y -= spaceship.speed; // Move upward
          cameraOffset.y = spaceship.y - canvas.height / 2; // Adjust camera to follow spaceship
          simulateAtmosphereAndHeat(); // Simulate heat buildup
          drawSpaceship(); // Redraw spaceship
        }
      }, 16); // ~60 FPS
    }

    // Event listener for the launch button
    document.getElementById("launchButton").addEventListener("click", launchSpaceship);

    loadSpaceshipParts();
    drawSpaceship(); // Start with an empty spaceship
  </script>
</body>
</html>
