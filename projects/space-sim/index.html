<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spaceship Gravity Simulation</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; background-color: #000; }
    .button-container { position: absolute; top: 10px; left: 10px; z-index: 10; }
    .button { padding: 10px; margin: 5px; background-color: #fff; cursor: pointer; display: flex; align-items: center; }
    .part-image { width: 30px; height: 30px; object-fit: contain; margin-right: 10px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div class="button-container" id="partButtons">
    <!-- Buttons will be populated here -->
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const G = 0.0001;
    let celestialBodies = [];
    let spaceship = { x: 500, y: 500, radius: 20, mass: 100, color: 'white', parts: [], vx: 0, vy: 0 };
    let parts = [];
    let camera = { x: spaceship.x, y: spaceship.y, width: canvas.width, height: canvas.height };

    // Load planets and parts data
    async function loadGameData() {
      const planetsResponse = await fetch('json/planets.json');
      const partsResponse = await fetch('json/parts.json');

      celestialBodies = await planetsResponse.json();
      parts = await partsResponse.json();

      createPartButtons();
      gameLoop();
    }

    // Create part selection buttons with images
    function createPartButtons() {
      const partButtonsContainer = document.getElementById('partButtons');
      parts.forEach(part => {
        const button = document.createElement('button');
        button.className = 'button';
        
        const img = document.createElement('img');
        img.src = part.image;  // Using the image path from the part JSON
        img.alt = part.name;
        img.className = 'part-image';
        
        button.appendChild(img);
        button.appendChild(document.createTextNode(` ${part.name}`));

        button.onclick = () => addPartToSpaceship(part);
        partButtonsContainer.appendChild(button);
      });
    }

    // Add selected part to the spaceship
    function addPartToSpaceship(part) {
      spaceship.parts.push(part);
      spaceship.mass += part.mass; // Increase mass based on the part's mass
      updateSpaceshipRadius(); // Optionally update radius based on mass
    }

    // Update spaceship radius (optional logic)
    function updateSpaceshipRadius() {
      spaceship.radius = Math.sqrt(spaceship.mass / Math.PI); // Example logic for size based on mass
    }

    // Gravitational calculations
    function calculateGravity(body1, body2) {
      const dx = body2.x - body1.x;
      const dy = body2.y - body1.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      const force = (G * body1.mass * body2.mass) / (distance * distance);
      return force;
    }

    // Game loop
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Adjust camera position based on spaceship position
      camera.x = spaceship.x - camera.width / 2;
      camera.y = spaceship.y - camera.height / 2;

      // Draw celestial bodies (planets, etc.)
      celestialBodies.forEach(body => {
        // Draw atmosphere if visible
        if (isBodyVisible(body)) {
          drawAtmosphere(body);
        }

        // Draw the planet itself
        ctx.beginPath();
        ctx.arc(body.x - camera.x, body.y - camera.y, body.radius, 0, Math.PI * 2);
        ctx.fillStyle = body.color || "#0000FF"; // Default blue color for planets
        ctx.fill();
        ctx.stroke();
      });

      // Draw spaceship
      ctx.beginPath();
      ctx.arc(spaceship.x - camera.x, spaceship.y - camera.y, spaceship.radius, 0, Math.PI * 2);
      ctx.fillStyle = spaceship.color;
      ctx.fill();
      ctx.stroke();

      celestialBodies.forEach(body => {
        const force = calculateGravity(spaceship, body);
        const angle = Math.atan2(body.y - spaceship.y, body.x - spaceship.x);
        spaceship.vx += force * Math.cos(angle) / spaceship.mass;
        spaceship.vy += force * Math.sin(angle) / spaceship.mass;

        // Move spaceship
        spaceship.x += spaceship.vx;
        spaceship.y += spaceship.vy;
      });

      requestAnimationFrame(gameLoop);
    }

    // Check if celestial body is visible in the camera's view
    function isBodyVisible(body) {
      const dx = body.x - spaceship.x;
      const dy = body.y - spaceship.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      // Make the body visible if it's within a certain distance from the spaceship and within camera bounds
      return distance < camera.width / 2;
    }

    // Draw atmosphere around the body if visible
    function drawAtmosphere(body) {
      ctx.beginPath();
      ctx.arc(body.x - camera.x, body.y - camera.y, body.radius + 50, 0, Math.PI * 2); // Radius of atmosphere
      ctx.fillStyle = "rgba(0, 0, 255, 0.3)"; // Light blue, semi-transparent for atmosphere effect
      ctx.fill();
    }

    loadGameData();
  </script>
</body>
</html>
