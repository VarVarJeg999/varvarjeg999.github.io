<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spaceship Builder</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    .ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      border-radius: 8px;
      font-family: Arial, sans-serif;
    }
    .ui h3 {
      margin: 0 0 10px;
    }
    .ui button {
      margin: 5px 0;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    .parts-list {
      max-height: 200px;
      overflow-y: auto;
      margin: 10px 0;
    }
    .part {
      cursor: grab;
      padding: 5px;
      margin: 5px 0;
      border: 1px solid white;
      background: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div class="ui" id="ui">
    <h3>Spaceship Builder</h3>
    <div class="parts-list" id="partsList"></div>
    <button id="launchButton">Launch</button>
    <button id="resetButton">Reset</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    const ctx = !gl ? canvas.getContext('2d') : null;
    const isWebGL = !!gl;

    let spaceship = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      parts: [],
      launched: false
    };

    const gridSize = 50;
    const parts = [
      { name: 'Engine', color: 'red', size: 50 },
      { name: 'Wing', color: 'blue', size: 50 },
      { name: 'Cockpit', color: 'green', size: 50 }
    ];
    let selectedPart = null;
    let offsetX = 0, offsetY = 0;

    // UI Elements
    const partsList = document.getElementById('partsList');
    const launchButton = document.getElementById('launchButton');
    const resetButton = document.getElementById('resetButton');

    // Resize canvas
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Populate parts list
    function loadParts() {
      partsList.innerHTML = '';
      parts.forEach(part => {
        const partElement = document.createElement('div');
        partElement.className = 'part';
        partElement.innerText = part.name;
        partElement.draggable = true;
        partElement.addEventListener('dragstart', () => {
          selectedPart = { ...part, x: 0, y: 0 };
        });
        partsList.appendChild(partElement);
      });
    }

    loadParts();

    // Snap to grid
    function snapToGrid(value) {
      return Math.round(value / gridSize) * gridSize;
    }

    // Rendering
    function render() {
      if (isWebGL) {
        renderWebGL();
      } else {
        renderCanvas();
      }
    }

    function renderCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw spaceship core
      ctx.fillStyle = 'gray';
      ctx.fillRect(spaceship.x - 25, spaceship.y - 25, 50, 50);

      // Draw parts
      spaceship.parts.forEach(part => {
        ctx.fillStyle = part.color;
        ctx.fillRect(
          spaceship.x + part.x - part.size / 2,
          spaceship.y + part.y - part.size / 2,
          part.size,
          part.size
        );
      });
    }

    function renderWebGL() {
      // Placeholder for WebGL rendering logic
      gl.clearColor(0.0, 0.0, 0.0, 1.0);
      gl.clear(gl.COLOR_BUFFER_BIT);
      // Add your WebGL rendering logic here
    }

    // Drag and drop logic
    canvas.addEventListener('dragover', (e) => e.preventDefault());

    canvas.addEventListener('drop', (e) => {
      if (selectedPart) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        selectedPart.x = snapToGrid(x - spaceship.x);
        selectedPart.y = snapToGrid(y - spaceship.y);

        spaceship.parts.push(selectedPart);
        selectedPart = null;
        render();
      }
    });

    // Launch spaceship
    launchButton.addEventListener('click', () => {
      spaceship.launched = true;
      let speed = 2;
      const interval = setInterval(() => {
        if (!spaceship.launched) {
          clearInterval(interval);
        }
        spaceship.y -= speed;
        render();
      }, 16);

      // Hide parts list
      document.getElementById('ui').style.display = 'none';
    });

    // Reset spaceship
    resetButton.addEventListener('click', () => {
      spaceship = { x: canvas.width / 2, y: canvas.height / 2, parts: [], launched: false };
      document.getElementById('ui').style.display = 'block';
      render();
    });

    render();
  </script>
</body>
</html>
